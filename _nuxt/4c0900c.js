(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{1100:function(e,t,r){"use strict";r.r(t);r(31),r(22),r(21),r(14),r(42),r(28),r(43);var n=r(2),o=r(16),c=(r(8),r(23)),l=r(788),d=r(700);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={components:{PaymentForm:l.default,BaseButton:d.default},props:{initialData:{type:Object,default:null}},data:function(){return{job:null,stripe:null,stripeError:null,fee:0,card:null,canCharge:!1,loading:!1,loadingCancel:!1}},computed:m(m({},Object(c.e)({bookingFee:function(e){return e.settings.bookingFee}})),{},{userHasDefaultPaymentMethod:function(){return this.user.has_default_payment_method}}),mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.job=e.initialData.data.job,t.next=3,e.getBookingFee(e.$auth.user.client.location.uuid);case 3:if(r=e.job.shift.start,n=new Date(new Date(r).toUTCString()),o=new Date,c=(n-o)/36e5,e.fee=c<24?e.bookingFee.urgent_fee:e.bookingFee.normal_fee,e.userHasDefaultPaymentMethod){t.next=18;break}return e.stripeError=null,t.next=13,Stripe("pk_test_51NL1t0LGY9YD22UM5aLmlndf0oXFE9B3QLiMg9BM8IEPhQHig1r5qqsgSaAyIbYSgPJYdEFmQGxCPWtZUPoRyKDg00m4Y3y8JM",{stripeAccount:e.stripeConnectAccountId});case 13:return e.stripe=t.sent,t.next=16,e.$axios.post("/transactions/setup-intent");case 16:l=t.sent,e.setupIntent=l.data.data;case 18:case"end":return t.stop()}}),t)})))()},methods:m(m({},Object(c.b)({getBookingFee:"settings/getBookingFee",deleteShift:"scheduler/deleteShift"})),{},{onCancelRequest:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loadingCancel=!0,t.next=4,e.deleteShift({shiftUuid:e.job.shift.uuid});case 4:e.$toast.showMessage({title:"Success",message:"Your shift was successfully deleted",type:"success"}),e.$modal.close(),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.showErrorToast("We were not able to delete the shift");case 11:return t.prev=11,e.loadingCancel=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})))()},showErrorToast:function(e){this.$toast.showMessage({title:"There was an error",message:e,type:"danger"})},setCard:function(e){this.card=e},setCanCharge:function(e){this.canCharge=e},submitPayment:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.userHasDefaultPaymentMethod){t.next=31;break}if(t.prev=1,e.loading=!0,r=e.job.shift.start,n=new Date(new Date(r).toUTCString()),o=new Date,!((c=n-o)/36e5<24)){t.next=16;break}return e.fee=e.bookingFee.urgent_fee,t.next=12,e.$axios.post("/transactions/process-booking-fee-payment",{job_uuid:e.job.uuid,fees:e.bookingFee.urgent_fee});case 12:t.sent.data.success&&(e.$toast.showMessage({title:"Success",message:"Your payment was processed successfully, we'll be working on your request!",type:"success"}),e.$modal.close()),t.next=21;break;case 16:return e.fee=e.bookingFee.normal_fee,t.next=19,e.$axios.post("/transactions/process-booking-fee-payment",{job_uuid:e.job.uuid,fees:e.bookingFee.normal_fee});case 19:t.sent.data.success&&(e.$toast.showMessage({title:"Success",message:"Your payment was processed successfully, we'll be working on your request!",type:"success"}),e.$modal.close());case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(1),e.showErrorToast("We were not able to process the payment");case 26:return t.prev=26,e.loading=!1,t.finish(26);case 29:t.next=68;break;case 31:return e.stripeError=null,e.loading=!0,t.prev=33,t.next=36,e.stripe.confirmCardSetup(e.setupIntent.client_secret,{payment_method:{card:e.card}});case 36:if(!(l=t.sent).error){t.next=42;break}e.stripeError=l.error.message,e.showErrorToast(e.stripeError),t.next=60;break;case 42:if("succeeded"!==l.setupIntent.status){t.next=60;break}return t.next=45,e.$axios.post("/transactions/update-default-payment-method",{payment_method_id:l.setupIntent.payment_method});case 45:if(!t.sent.data.success){t.next=60;break}if(!(c/36e5<24)){t.next=56;break}return e.fee=e.bookingFee.urgent_fee,t.next=52,e.$axios.post("/transactions/process-booking-fee-payment",{job_uuid:e.job.uuid,fees:e.bookingFee.urgent_fee});case 52:t.sent.data.success&&(e.$toast.showMessage({title:"Success",message:"Your payment was processed successfully, we'll be working on your request!",type:"success"}),e.$modal.close(),e.$auth.fetchUser()),t.next=60;break;case 56:return t.next=58,e.$axios.post("/transactions/process-booking-fee-payment",{job_uuid:e.job.uuid,fees:e.bookingFee.normal_fee});case 58:t.sent.data.success&&(e.$toast.showMessage({title:"Success",message:"Your payment was processed successfully, we'll be working on your request!",type:"success"}),e.$modal.close(),e.$auth.fetchUser());case 60:t.next=65;break;case 62:t.prev=62,t.t1=t.catch(33),console.log(t.t1);case 65:return t.prev=65,e.loading=!1,t.finish(65);case 68:case"end":return t.stop()}}),t,null,[[1,23,26,29],[33,62,65,68]])})))()}})},y=r(5),component=Object(y.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"modal w-[600px] p-5 z-10"},[r("div",{staticClass:"mx-4 mb-4"},[r("h4",{staticClass:"title-l-600 mb-2"},[e._v("Booking fee")]),e._v(" "),e.userHasDefaultPaymentMethod?r("div",{staticClass:"space-y-4"},[r("div",{staticClass:"grid grid-cols-2 gap-4"},[r("BaseButton",{staticClass:"w-full",attrs:{text:"Confirm Payment $"+e.fee,loading:e.loading},on:{click:e.submitPayment}}),e._v(" "),r("BaseButton",{attrs:{text:"Cancel Request","btn-style":"outline",loading:e.loadingCancel},on:{click:e.onCancelRequest}})],1)]):r("div",{staticClass:"w-full"},[e.stripe?r("PaymentForm",{staticClass:"card",attrs:{stripe:e.stripe,error:e.stripeError},on:{card:e.setCard,canCharge:e.setCanCharge}}):e._e(),e._v(" "),r("div",{staticClass:"grid grid-cols-2 gap-4"},[r("BaseButton",{staticClass:"w-full",attrs:{text:"Confirm Payment $"+e.fee,disabled:!e.canCharge,loading:e.loading},on:{click:e.submitPayment}}),e._v(" "),r("BaseButton",{attrs:{text:"Cancel Request","btn-style":"outline",loading:e.loadingCancel},on:{click:e.onCancelRequest}})],1)],1)])])}),[],!1,null,null,null);t.default=component.exports},748:function(e,t,r){var content=r(781);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(51).default)("39871fd2",content,!0,{sourceMap:!1})},780:function(e,t,r){"use strict";r(748)},781:function(e,t,r){var n=r(50)((function(i){return i[1]}));n.push([e.i,".nuxt-link-exact-active[data-v-6ad2f9d9]{color:var(--primary-default-color)}.formWidth[data-v-6ad2f9d9]{width:450px}@media only screen and (max-width:430px){.formWidth[data-v-6ad2f9d9]{width:350px}}@media only screen and (max-width:320px){.formWidth[data-v-6ad2f9d9]{width:300px}}.text-input[data-v-6ad2f9d9]{font-family:Nunito;font-size:14px;font-weight:400;line-height:21px;margin-top:0.25rem;display:block;width:100%;border-width:1px;--tw-border-opacity:1;border-color:rgb(211 208 197 / var(--tw-border-opacity));--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));padding-top:0.5rem;padding-bottom:0.5rem;outline:2px solid transparent;outline-offset:2px;--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.input-cont[data-v-6ad2f9d9]{border-radius:0.75rem;--tw-border-opacity:1;border-color:rgb(214 216 213 / var(--tw-border-opacity));padding-left:1rem;padding-right:1rem}",""]),n.locals={},e.exports=n},788:function(e,t,r){"use strict";r.r(t);r(31),r(22),r(21),r(14),r(42),r(28),r(43);var n=r(2),o=r(16),c=(r(8),r(23)),l=r(188);function d(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m={name:"Payment",components:{InputLabel:r(705).default},layout:"guest",props:{stripe:{type:Object,required:!0},error:{type:String,required:!1,default:""}},data:function(){return{loading:!1,disabled:!1,cardNumber:null,isNumberFilled:!1,isExpiryFilled:!1,isCvcFilled:!1,expiryError:"",numberError:"",cvcError:""}},computed:{cardStyles:function(){return{base:{fontSize:"14px",paddingTop:"0.5rem",fontWeight:400,lineHeight:"21px",backgroundColor:"white",height:"100%"}}},canCharge:function(){return this.isNumberFilled&&this.isExpiryFilled&&this.isCvcFilled}},watch:{canCharge:function(e){this.$emit("canCharge",e)}},methods:f(f({},Object(c.b)({storeApplication:"applications/store"})),{},{createStripeCard:function(){var e=this,t=this.stripe.elements({fonts:[{cssSrc:"https://fonts.googleapis.com/css2?family=Work+Sans:wght@400"}],locale:"auto"}),r=this.$refs;this.cardNumber=t.create("cardNumber",{style:this.cardStyles}),this.cardNumber.mount(r.stripeCardNumber);var n=t.create("cardExpiry",{classes:this.cardClasses,style:this.cardStyles});n.mount(r.stripeCardExpiry);var o=t.create("cardCvc",{classes:this.cardClasses,style:this.cardStyles});o.mount(r.stripeCardCVC),this.cardNumber.on("change",this.handleNumberChange),this.cardNumber.on("blur",(function(t){return e.blurStripeE(r.stripeCardNumber,t)})),this.cardNumber.on("focus",(function(t){return e.focusStripeElement(r.stripeCardNumber,t)})),n.on("change",this.handleExpiryChange),n.on("blur",(function(t){return e.blurStripeE(r.stripeCardExpiry,t)})),n.on("focus",(function(t){return e.focusStripeElement(r.stripeCardExpiry,t)})),o.on("change",this.handleCvcChange),o.on("blur",(function(t){return e.blurStripeE(r.stripeCardCVC,t)})),o.on("focus",(function(t){return e.focusStripeElement(r.stripeCardCVC,t)}))},blurStripeE:function(e){e.parentNode.classList.remove("ring-2"),e.parentNode.classList.remove("ring-primary")},focusStripeElement:function(e){e.parentNode.classList.add("ring-2"),e.parentNode.classList.add("ring-primary")},handleNumberChange:function(e){var t=e.complete,r=e.error;this.isNumberFilled=t,this.numberError=r?r.message:"",this.$emit("card",this.cardNumber)},handleExpiryChange:function(e){var t=e.complete,r=e.error;this.isExpiryFilled=t,this.expiryError=r?r.message:""},handleCvcChange:function(e){var t=e.complete,r=e.error;this.isCvcFilled=t,this.cvcError=r?r.message:""},store:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,r=e.$route.params.locationUuid,t.next=5,e.storeApplication({application_type:l.a,locationUuid:r});case 5:e.$toast.showMessage({title:"Success",message:"Client application successfully sent.",type:"success"}),e.$router.push({path:"/applications/client/location/".concat(r,"/sent")}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),e.$toast.showMessage({title:"Something went wrong",message:"Please check the form data.",type:"danger"});case 12:e.loading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}),mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.disabled=!0,t.next=3,e.createStripeCard();case 3:e.disabled=!1;case 4:case"end":return t.stop()}}),t)})))()}},h=(r(780),r(5)),component=Object(h.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"formWidth mx-auto my-8"},[r("div",{staticClass:"body-l-400 text-center mb-8"},[r("div",[r("div",{staticClass:"grid grid-cols-6 gap-x-4 gap-y-9"},[r("div",{staticClass:"col-span-6"},[r("InputLabel",{attrs:{text:"Card Number"}}),e._v(" "),r("div",{staticClass:"text-input input-cont"},[r("div",{ref:"stripeCardNumber",staticClass:"w-full"})]),e._v(" "),e.numberError?r("h4",{staticClass:"text-danger caption-s-500 mt-2"},[e._v(e._s(e.numberError))]):e._e()],1),e._v(" "),r("div",{staticClass:"col-span-3"},[r("InputLabel",{attrs:{text:"Expiration"}}),e._v(" "),r("div",{staticClass:"text-input input-cont"},[r("div",{ref:"stripeCardExpiry",staticClass:"w-full"})]),e._v(" "),e.expiryError?r("h4",{staticClass:"text-danger caption-s-500 mt-2"},[e._v(e._s(e.expiryError))]):e._e()],1),e._v(" "),r("div",{staticClass:"col-span-3"},[r("InputLabel",{attrs:{text:"CVC"}}),e._v(" "),r("div",{staticClass:"text-input input-cont"},[r("div",{ref:"stripeCardCVC",staticClass:"w-full"})]),e._v(" "),e.cvcError?r("h4",{staticClass:"text-danger caption-s-500 mt-2"},[e._v(e._s(e.cvcError))]):e._e()],1)]),e._v(" "),e.error?r("p",{staticClass:"text-danger caption-s-500 mt-2"},[e._v(e._s(e.error))]):e._e()])])])}),[],!1,null,"6ad2f9d9",null);t.default=component.exports}}]);